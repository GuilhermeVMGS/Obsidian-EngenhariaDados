
Quando executamos um script SQL ele não é executado linha por linha mas sim é analisado e otimizado. Após isso, é executado um plano baseado no resultado final desejado.

1. *Envio do Script:* 
* Após a execução do script, pensando no SQL Server, ele é enviado ao SQL Server Engine (que é o núcleo do SQL Server, com o conjunto de componentes responsáveis por receber comandos, interpretar e otimizar queries, executar transações, gerenciar dados, garantir ACID/segurança/concorrência).

1. *Parser (Análise Sintática):* apenas verifica se a gramática está certa.
* O SQL Server verifica se a sintaxe é válida
* Confere nomes de tabelas e colunas
* Valida permissões
* Confere tipos de dados

3. *Algebrizador (Binding / Álgebra Relacional):*
* Traduz o SQL em operações de álgebra relacional
* Resolve: JOINS, GROUP BY e funções agregadas
* Expande *SELECT* 
* Define cardinalidades iniciais
* Ainda não executa nada

4. *Otimizador de Consultas (Query Optimizer):*
* Avalia várias formas possíveis de executar a query
* Decide a ordem dos JOINS
* Decide o uso ou não de índices
* Decide o tipo de JOIN (Nested Loop, Hash, Merge)
* Decide a estratégia de agregação
* Calcula o custo estimado de cada plano e o escolhe.
Aqui, o plano escolhido pode usar paralelismo, criar operadores intermediários ou reordenar operações (respeitando o resultado lógico).

5. *Geração do Plano de Execução* - o resultado do otimizador é um plano de execução. Que é:
* Uma árvore de operadores
* Cada operador faz parte do processamento.
* Ele pode ser cacheado (reutilizado) ou recompilado (se necessário.)

6. *Execução (Execution Engine):*
* O execution engine executa o plano
* Não segue a ordem escrita no SQL, segue a ordem do plano

4. *Retorno do Resultado:*
* O resultado é enviado de volta ao cliente
* Pode ser streamado (linha a linha), ou seja, não espera tudo terminar para começar a retornar.
![[Pasted image 20260106204231.png]]
Obs.: o *SELECT* não executa, apenas define a projeção final.